{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<title>NSO Bingo caller</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/png" href="{% static 'icons/favicon.ico' %}"/>
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'fonts/font-awesome-4.7.0/css/font-awesome.min.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/animate/animate.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/select2/select2.min.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/util.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/main.css'%}">

</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-dark upei-red">
	  <a class="navbar-brand text-light" href="#">UPEI NSO BINGO</a>
	</nav>
	<div class="container-fluid">
		<div class="row p-5">
			<div class="col-md-6 d-flex flex-column flex-row justify-content-center">
				{% comment %} maybe make a list of the values available? And then highlight or cross out ones that get called? {% endcomment %}
				<textarea id="callednumbers" class="callednumbers" disabled="true">{{ called }}</textarea>
				<button id="callnumber" class="btn btn-block">Call Number</button>
			</div> 
			<div class="col-md-6">
				<button type="button" class="btn btn-lg btn-success btn-block">Valid Bingo</button> 
				<button type="button" class="btn btn-danger btn-lg btn-block">Reset Game</button>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<table class="table table-bordered table-dark" id="active-users">
					<thead class="thead-dark">
						<th>Name</th>
						<th>Team</th>
						<th>Card</th>
					</thead>
				</table>
			</div>
		</div>
	</div>
	<script>
        const callerSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/call/'
        );
		callerSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            document.querySelector('#callednumbers').value += (data.number + '  ');
        };
        callerSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        document.querySelector('#callnumber').onclick = function(e) {
            callerSocket.send(JSON.stringify({}));
        };
		const bingoSocket = new WebSocket('ws://' + window.location.host + '/ws/bingo/')
		bingoSocket.onmessage = function(e) {
			const data = JSON.parse(e.data);
			console.log(data.type)
			switch(data.type) {
				case "bingo": 
					alert(data.bingo_alert);
					break;
				case "login": 
					// Add to table that doesn't exist yet
					var users = document.getElementById('active-users');
					var row = users.insertRow();
					row.id=data.name
					row.insertCell().innerHTML=data.name;
					row.insertCell().innerHTML=data.team;
					row.insertCell().innerHTML=data.card;
					break;
				case "logout": 
					var row = document.getElementById(data.name);
					row.parentNode.removeChild(row);
					break

			}
		}
    </script>

	<script src="{% static 'vendor/jquery/jquery-3.2.1.min.js'%}"></script>
	<script src="{% static 'vendor/bootstrap/js/popper.js'%}"></script>
	<script src="{% static 'vendor/bootstrap/js/bootstrap.min.js'%}"></script>
	<script src="{% static 'vendor/select2/select2.min.js'%}"></script>
	<script src="{% static 'js/main.js'%}"></script>

</body>
</html>
