{% extends 'base.html' %}
{% load static %}
{% block content %}
<script src="{% static 'js/caller.js'%}"></script>

<div class="container-fluid">
	<div class="row p-5">
		<div class="col">
			{% comment %} maybe make a list of the values available? And then highlight or cross out ones that get called? {% endcomment %}
			{% include '_numbergrid.html' %}
			<button id="callnumber" class="btn btn-primary btn-lg btn-block">Call Number</button>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6">
			<button id="resetnumbers" type="button" class="btn btn-warning btn-lg btn-block">Reset Game</button>
		</div>
		<div class="col-md-6">
			<button id="newnumbers" type="button" class="btn btn-danger btn-lg btn-block"  data-toggle="modal" data-target="#newnumbersmodal">Reset Game with new Values</button>
		</div>
	</div>
	<div class="row">
		<div class="col-6" id="activity"></div>
		<div class="col-6">
			<button class="btn btn-secondary dropdown-toggle btn-block"  type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				Available Cards
			</button>
			<div id="card-ids" class="dropdown-menu btn-block" aria-labelledby="dropdownMenuButton"></div>
			
			<div class='collapse show' id="cardcolllapse">
				<table id='user-card' class="table card-table table-bordered">
					<thead>
						<tr class="cardRow head">
							<th>B</th>
							<th>I</th>  
							<th>N</th>
							<th>G</th>
							<th>O</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="newnumbersmodal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Enter New Numbers</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <textarea name="newnumbers" style="width: 100%; min-height: 300px;" class="form-control" id="newnumbersarea">{{ numbers|join:", " }}</textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" id="submitnewnumbers" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
<script>

function toggleCollapse() {
$("#user-card tbody").empty();
var id = $(event.target).text();
var	protocol = window.location.protocol === "http:" ? "http://":"https://";

$.ajax({
	url: protocol + window.location.host + "/" + id,
	contentType: "application/json",
	dataType: "json",
	success: function (result) {
		var data = JSON.parse(result);
		// append rows to table body
		for (var i = 0; i < data.numbers.length; i += 5) {
			var row = '<tr class="cardRow">';
			for (var j = i; j < i + 5; j++) {
			row += "<td ";
			if ($.inArray(data.numbers[j], data.called) >= 0) {
				row += 'class="upei-gold"';
			}
			if (data.numbers[j] === "FREE") {
				row += 'class="upei-gold"';
			}
			row += ">" + data.numbers[j] + "</td>";
			}
			row += "</tr>";
			$("#user-card tbody").append(row);
			$("#cardcollapse").collapse("show");
		}
	}
});
}
</script>
{% endblock %}
