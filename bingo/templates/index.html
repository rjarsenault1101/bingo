{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<title>NSO Bingo</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/png" href="{% static 'images/icons/favicon.ico' %}"/>
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'fonts/font-awesome-4.7.0/css/font-awesome.min.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/animate/animate.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/select2/select2.min.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/util.css'%}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/main.css'%}">

</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-dark upei-red">
	  <a class="navbar-brand text-light" href="#">UPEI NSO BINGO</a>
	</nav>
	<div class="container p-b-100">
		<div class="row align-middle">
			<form onsubmit="setup()">
				<div class="input-group">
					<input type="text" class="form-control" id="name" placeholder="Name (first and last)">
					<select class="form-control" id="team">
						<option>Red</option>
						<option>Orange</option>
						<option>Green</option>
						<option>Blue</option>
						<option>Purple</option>
					</select>
					<input type="submit" class="btn btn-secondary" id="enterName"/>
				</div>
			</form>
		</div>
	</div>
	{% comment %} Enter name, select team from dropdown {% endcomment %}
	<div class="container p-b-100">
		
		<div class="row">
			<div class="col-md-6">
				<div class="table100">
					<table>
						<thead>
							<tr class="cardRow head">
								<th>U</th>
								<th>P</th>
								<th>üê±‚Äçüë§</th>
								<th>E</th>
								<th>I</th>
							</tr>
						</thead>
						<tbody>
							{% for cell in numbers %}
							{% if forloop.counter0|divisibleby:"5" %}
							{% if forloop.counter0 > 0 %}</tr>{% endif %}
							<tr class="cardRow">
							{% endif %}
								<td class="free">
									{{ cell }}
								</td>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
			<div class="col-md-6">
				<p>Called Numbers:</p>
				<textarea id="callednumbers" disabled="true">{{ called }}</textarea>
				
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
				<div class="bingo-button">				
					<button id="bingo" class="btn btn-secondary btn-lg" disabled="true">BINGO!</button>
				</div>
			</div>
			<div class="col-md-6">
				<div class="new-card-button">
					<button id="newcard" class="btn btn-secondary btn-lg" disabled="true" onclick="location.href='{% url 'new' %}'">New Card</button>
				</div>
			</div>
		</div>
	</div>
	

	<script>
		function setup(e) {
			console.log("is this thing on?");
			document.querySelector('#bingo').removeAttribute("disabled");
			document.querySelector('#newcard').removeAttribute("disabled");
			const name = document.querySelector("#name").value;
			const team = document.querySelector("#team").value;
			console.log(name + " " + team);
			const bingoSocket = new WebSocket('ws://' + window.location.host + '/ws/bingo/?name=' + name +'&team=' + team + '&card=' + '{{card_id}}');
			// get users name and team, stick em in query params here: ---------------------v
			bingoSocket.onmessage = function(e) {
				// Received a thing? Probably don't need
			};
			bingoSocket.onclose = function(e) {
				console.error('Bingo socket closed unexpectedly');
			}
			document.querySelector("#bingo").onclick = function(e) {
			bingoSocket.send(JSON.stringify({
				'name': name,
				'team': team,
				'card_id': '{{card_id}}'
			}))
		}
		}
		
		
		
        const numberSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/call/'
        );
		numberSocket.onmessage = function(e) {
            console.log('received message')
            const data = JSON.parse(e.data);
			console.log(data.number);
            document.querySelector('#callednumbers').value += (data.number + '  ');
        };
        numberSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };
    </script>
	<script src="{% static 'vendor/jquery/jquery-3.2.1.min.js'%}"></script>
	<script src="{% static 'vendor/bootstrap/js/popper.js'%}"></script>
	<script src="{% static 'vendor/bootstrap/js/bootstrap.min.js'%}"></script>
	<script src="{% static 'vendor/select2/select2.min.js'%}"></script>
	<script src="{% static 'js/main.js'%}"></script>

</body>
</html>
